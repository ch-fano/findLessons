{% extends "base.html" %}

{% block title %} {{ title }} {% endblock %}

{% block head %}
<style>
    html, body {
        height: 100%;
        margin: 0;
    }
    .calendar {
        display: flex;
        margin: 30px 0 10px;
        flex-direction: column;
        gap: 10px;
        padding: 0 20px;
    }
    .calendar-week {
        display: flex;
        width: 100%;
        gap: 10px;
        justify-content: space-between;
    }
    .calendar-day {
        border: 1px solid #ddd;
        padding: 10px;
        box-sizing: border-box;
        flex: 1;
        min-width: 120px;
        height: 150px;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        background-color: #e3f2fd;
        overflow: hidden;
        position: relative;
    }
    .calendar-day.today {
        background-color: #c9cff9;
    }
    .calendar-day h4 {
        margin: 0;
        text-align: center;
        background: #5d9bde;
        color: #fff;
        padding: 5px;
        border-bottom: 1px solid #ddd;
        font-size: 14px;
        position: sticky;
        top: 0;
        z-index: 1;
    }
    .calendar-day ul {
        list-style: none;
        padding: 0;
        margin: 0;
        text-align: center;
        flex-grow: 1;
        overflow-y: auto;
    }
    .calendar-day li {
        font-size: 14px;
        position: relative;
        cursor: pointer;
        padding: 5px;
    }
    .calendar-day li.availability {
        background-color: #e0f4ac;
    }
    .calendar-day li.lesson {
        background-color: #f4bcac;
    }
    .calendar-day li:hover .action-buttons {
        display: flex;
    }
    .action-buttons {
        display: none;
        position: absolute;
        background: #f1f1f1;
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 5px;
        font-size: 12px;
        z-index: 10;
        white-space: nowrap;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    .action-buttons button {
        background: #4CAF50;
        color: #fff;
        border: none;
        padding: 5px 10px;
        margin: 0 5px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 12px;
    }
    .action-buttons button:hover {
        background: #45a049;
    }
    .action-buttons .change-button {
        margin-right: 2px;
    }
    .action-buttons .delete-button {
        margin-left: 2px;
    }
    .calendar-header {
        text-align: center;
        margin: 30px 0 10px;
        font-size: 20px;
        font-weight: bold;
    }
    .centered-button-container {
        display: flex;
        justify-content: center;
        margin-top: 15px;
    }
</style>
{% endblock %}

{% block content %}
    <input type="button" value="← Back" onClick="history.go(-1);" class="back-button btn-custom">
    <div class="calendar-header">Teacher {{ teacher_name }} availabilities:</div>
    <div class="calendar">
        {% for week in calendar_weeks %}
            <div class="calendar-week">
                {% for day in week %}
                    <div class="calendar-day {% if day.date == today %}today{% endif %}">
                        <h4>{{ day.date|date:"D, M j" }}</h4>
                        <ul>
                            {% for event in day.events %}
                                {% if event.type == 'availability' %}
                                    <li class="availability">
                                        {{ event.time }}
                                        <div class="action-buttons">
                                            {% if is_me %}
                                                <a href="{% url 'reservation:availability-update' event.id %}" class="btn-custom change-button" style="text-decoration: none;">Change</a>
                                                <a href="{% url 'reservation:availability-delete' event.id %}" class="btn-custom delete-button" style="text-decoration: none;">Delete</a>
                                            {% else %}
                                                <a href="{% url 'reservation:lesson-create' event.id %}" class="btn-custom" style="text-decoration: none;">Book lesson</a>
                                            {% endif %}
                                        </div>
                                    </li>
                                {% else %}
                                    <li class="lesson">
                                        {{ event.time }} - {{ event.subject }}
                                        <div class="action-buttons">
                                            <a href="{% url 'reservation:lesson-view' event.id %}" class="btn-custom" style="text-decoration: none;">View lesson</a>
                                        </div>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
    </div>

        <div class="centered-button-container">
            {% if is_me %}
                <a href="{% url 'reservation:availability-create'%}" class="btn-custom" style="text-decoration: none;">Set new availability</a>
            {% else %}
                <h3>Click on an availability to book a lesson</h3>
            {% endif %}
        </div>

    <script>
        document.querySelectorAll('.calendar-day li').forEach(li => {
            li.addEventListener('mouseenter', function(e) {
                const buttons = this.querySelector('.action-buttons');
                if (buttons) {
                    buttons.style.display = 'flex';
                }
            });

            li.addEventListener('mouseleave', function() {
                const buttons = this.querySelector('.action-buttons');
                if (buttons) {
                    buttons.style.display = 'none';
                }
            });
        });
    </script>
{% endblock %}
